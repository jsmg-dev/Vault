<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LIC Policy Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 20px;
    }

    h2 {
      text-align: center;
      color: #4a148c;
      margin-bottom: 20px;
    }

    form {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
    }

    fieldset {
      border: 1px solid #ccc;
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 8px;
    }

    legend {
      font-weight: bold;
      color: #4a148c;
      padding: 0 10px;
    }

    .form-group {
      display: flex;
      gap: 15px;
      margin-bottom: 12px;
    }

    .form-group label {
      flex: 1;
      font-weight: bold;
      color: #333;
    }

    .form-group input, 
    .form-group select, 
    .form-group textarea {
      flex: 2;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }

    textarea {
      resize: vertical;
    }

    .submit-btn {
      text-align: center;
    }

    .submit-btn button {
      background: #4a148c;
      color: #fff;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }

    .submit-btn button:hover {
      background: #6a1b9a;
    }

    .message {
      text-align: center;
      margin-top: 15px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>LIC Policy Details Form</h2>
  <form id="policyForm">
    <!-- your same fields here (kept unchanged) -->

    <fieldset>
      <legend>Policy Information</legend>
      <div class="form-group">
        <label for="policy_no">Policy Number</label>
        <input type="text" id="policy_no" name="policy_no" required>
      </div>
      <div class="form-group">
        <label for="plan_name">Plan Name</label>
        <input type="text" id="plan_name" name="plan_name">
      </div>
      <div class="form-group">
        <label for="start_date">Start Date</label>
        <input type="date" id="start_date" name="start_date">
      </div>
      <div class="form-group">
        <label for="end_date">End Date</label>
        <input type="date" id="end_date" name="end_date">
      </div>
      <div class="form-group">
        <label for="mode_of_payment">Mode of Payment</label>
        <input type="text" id="mode_of_payment" name="mode_of_payment">
      </div>
      <div class="form-group">
        <label for="next_premium_date">Next Premium Date</label>
        <input type="date" id="next_premium_date" name="next_premium_date">
      </div>
      <div class="form-group">
        <label for="sum_assured">Sum Assured</label>
        <input type="number" id="sum_assured" name="sum_assured" step="0.01">
      </div>
      <div class="form-group">
        <label for="policy_term">Policy Term (Years)</label>
        <input type="number" id="policy_term" name="policy_term">
      </div>
      <div class="form-group">
        <label for="premium_term">Premium Term (Years)</label>
        <input type="number" id="premium_term" name="premium_term">
      </div>
      <div class="form-group">
        <label for="premium">Premium</label>
        <input type="number" id="premium" name="premium" step="0.01">
      </div>
      <div class="form-group">
        <label for="maturity_value">Maturity Value</label>
        <input type="number" id="maturity_value" name="maturity_value" step="0.01">
      </div>
    </fieldset>

    <fieldset>
      <legend>Personal Information</legend>
      <div class="form-group">
        <label for="fullname">Full Name</label>
        <input type="text" id="fullname" name="fullname" required>
      </div>
      <div class="form-group">
        <label for="dob">Date of Birth</label>
        <input type="date" id="dob" name="dob">
      </div>
      <div class="form-group">
        <label for="gender">Gender</label>
        <select id="gender" name="gender">
          <option value="">Select</option>
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
        </select>
      </div>
      <div class="form-group">
        <label for="marital_status">Marital Status</label>
        <input type="text" id="marital_status" name="marital_status">
      </div>
      <div class="form-group">
        <label for="aadhaar_pan">Aadhaar/PAN</label>
        <input type="text" id="aadhaar_pan" name="aadhaar_pan">
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email">
      </div>
      <div class="form-group">
        <label for="mobile">Mobile</label>
        <input type="text" id="mobile" name="mobile">
      </div>
      <div class="form-group">
        <label for="address">Address</label>
        <textarea id="address" name="address"></textarea>
      </div>
      <div class="form-group">
        <label for="height_cm">Height (cm)</label>
        <input type="number" id="height_cm" name="height_cm" step="0.01">
      </div>
      <div class="form-group">
        <label for="weight_kg">Weight (kg)</label>
        <input type="number" id="weight_kg" name="weight_kg" step="0.01">
      </div>
      <div class="form-group">
        <label for="health_lifestyle">Health Lifestyle</label>
        <input type="text" id="health_lifestyle" name="health_lifestyle">
      </div>
    </fieldset>

    <fieldset>
      <legend>Nominee Details</legend>
      <div class="form-group">
        <label for="nominee_name">Nominee Name</label>
        <input type="text" id="nominee_name" name="nominee_name">
      </div>
      <div class="form-group">
        <label for="nominee_relation">Nominee Relation</label>
        <input type="text" id="nominee_relation" name="nominee_relation">
      </div>
    </fieldset>

    <fieldset>
      <legend>Bank & Branch Details</legend>
      <div class="form-group">
        <label for="bank_account">Bank Account</label>
        <input type="text" id="bank_account" name="bank_account">
      </div>
      <div class="form-group">
        <label for="ifsc_code">IFSC Code</label>
        <input type="text" id="ifsc_code" name="ifsc_code">
      </div>
      <div class="form-group">
        <label for="bank_name">Bank Name</label>
        <input type="text" id="bank_name" name="bank_name">
      </div>
      <div class="form-group">
        <label for="agent_code">Agent Code</label>
        <input type="text" id="agent_code" name="agent_code">
      </div>
      <div class="form-group">
        <label for="branch_code">Branch Code</label>
        <input type="text" id="branch_code" name="branch_code">
      </div>
    </fieldset>

    <div class="submit-btn">
      <button type="submit">Submit</button>
    </div>
  </form>

  <div class="message" id="msg"></div>

  <script>
  const form = document.getElementById("policyForm");
  const msg = document.getElementById("msg");

  // Check if editing (URL has ?id=123)
  const urlParams = new URLSearchParams(window.location.search);
  const policyId = urlParams.get("id");

  if (policyId) {
    document.querySelector("h2").textContent = "Edit LIC Policy";
    document.querySelector("button[type='submit']").textContent = "Update";

    // Fetch policy data and pre-fill form
    fetch(`/policies/${policyId}`)
      .then(res => res.json())
      .then(data => {
        if (data) {
          Object.keys(data).forEach(key => {
            if (form[key]) form[key].value = data[key] || "";
          });
        }
      })
      .catch(err => console.error("❌ Error loading policy:", err));
  }

  // Form submit
  form.addEventListener("submit", async function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const data = Object.fromEntries(formData.entries());

    try {
      let res;
      if (policyId) {
        // Update existing
        res = await fetch(`/policies/update/${policyId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
      } else {
        // Add new
        res = await fetch("/policies/add", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
      }

      const result = await res.json();
      if (result.success) {
        window.location.href = "licpolicymanagement.html"; // back to grid
      } else {
        msg.style.color = "red";
        msg.textContent = "❌ Failed to save policy.";
      }
    } catch (err) {
      console.error(err);
      msg.style.color = "red";
      msg.textContent = "❌ Error connecting to server.";
    }
  });
</script>

</body>
</html>
