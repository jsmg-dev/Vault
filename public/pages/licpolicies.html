<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>LIC Policy Management</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root{
      --nav:#0f1724;
      --primary:#004aad;
      --accent:#7c3aed;
      --muted:#6b7280;
      --bg:#f3f6fb;
      --card:#ffffff;
      --radius:12px;
      --border:#e6e9ef;
      --danger:#ef4444;
      --success:#10b981;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:#111}
    .navbar{background:var(--nav);padding:14px 22px;color:#fff;display:flex;justify-content:space-between;align-items:center}
    .navbar-title{font-weight:700;letter-spacing:0.2px}
    .navbar-right{display:flex;gap:10px;align-items:center}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:9px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
    .btn-back{background:#ef4444;color:#fff;text-decoration:none}
    .btn-primary{background:var(--primary);color:#fff}
    .container{max-width:1100px;margin:26px auto;padding:0 18px}
    .page-card{background:var(--card);border-radius:var(--radius);padding:22px;box-shadow:0 8px 30px rgba(15,23,36,0.06)}
    .page-header{display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap}
    .page-title{margin:0;color:var(--accent);font-size:22px;font-weight:700}
    .subtitle{color:var(--muted);font-size:13px}
    .section{margin-top:18px;padding:16px;border:1px solid var(--border);border-radius:10px;background:#fcfbff}
    .section h3{margin:0 0 12px;color:var(--primary);font-size:15px;display:flex;gap:8px;align-items:center}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
    .col-12{grid-column:span 12}.col-8{grid-column:span 8}.col-6{grid-column:span 6}.col-4{grid-column:span 4}
    @media (max-width:900px){.col-8,.col-6,.col-4{grid-column:span 12}}
    label{display:block;font-weight:600;margin-bottom:6px;font-size:14px}
    input,select,textarea{width:100%;padding:11px;border:1px solid var(--border);border-radius:10px;background:#fff;font-size:14px}
    input:focus,select:focus,textarea:focus{outline:none;box-shadow:0 6px 18px rgba(2,6,23,0.06);border-color:var(--primary)}
    textarea{min-height:90px;resize:vertical}
    .required{color:var(--danger)}
    .form-footer{display:flex;gap:12px;justify-content:flex-end;margin-top:18px}
    .toast{position:fixed;right:20px;bottom:20px;background:var(--success);color:#fff;padding:12px 16px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.12);display:none;z-index:9999}
    .toast.error{background:var(--danger)}
    .small{font-size:13px;color:var(--muted)}
    /* subtle responsive tweaks */
    @media (max-width:560px){.page-card{padding:14px}}
  </style>
</head>
<body>
  <div class="navbar">
    <div class="navbar-title">Policy Management</div>
    <div class="navbar-right">
      <a href="/pages/dashboard.html" class="btn btn-back"><i class="fa fa-arrow-left"></i>&nbsp;Back</a>
      <a href="/auth/logout" class="btn btn-back"><i class="fa fa-sign-out-alt"></i>&nbsp;Logout</a>
    </div>
  </div>

  <div class="container">
    <div class="page-card">
      <div class="page-header">
        <div>
          <h1 class="page-title">Create / Add LIC Policy</h1>
          <div class="subtitle small">Only <strong>Name</strong> and <strong>DOB</strong> are required. Policy No auto-generated if left blank.</div>
        </div>
        <button id="quickSaveBtn" class="btn btn-primary"><i class="fa fa-save"></i> Quick Save</button>
      </div>

      <form id="policyForm" autocomplete="off">
        <!-- Policy ID -->
        <div class="section">
          <h3><i class="fa fa-hashtag"></i> Policy</h3>
          <div class="grid">
            <div class="col-4">
              <label for="policy_no">Policy No <span class="small">leave blank to auto-generate</span></label>
              <input id="policy_no" name="policy_no" type="text" placeholder="e.g. LIC-00001" />
            </div>
            <div class="col-4">
              <label for="plan_name">Plan Name</label>
              <input id="plan_name" name="plan_name" type="text" placeholder="Plan name (e.g., Jeevan Anand)" />
            </div>
            <div class="col-4">
              <label for="status">Status</label>
              <select id="status" name="status">
                <option value="Active">Active</option>
                <option value="Lapsed">Lapsed</option>
                <option value="Matured">Matured</option>
                <option value="Surrendered">Surrendered</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Personal -->
        <div class="section">
          <h3><i class="fa fa-user"></i> Personal Information</h3>
          <div class="grid">
            <div class="col-6">
              <label for="fullname">Full Name <span class="required">*</span></label>
              <input id="fullname" name="fullname" type="text" placeholder="Policy holder full name" required />
            </div>
            <div class="col-6">
              <label for="dob">Date of Birth <span class="required">*</span></label>
              <input id="dob" name="dob" type="date" required />
            </div>
            <div class="col-4">
              <label for="gender">Gender</label>
              <select id="gender" name="gender">
                <option value="">-- Select --</option>
                <option>Male</option><option>Female</option><option>Other</option>
              </select>
            </div>
            <div class="col-4">
              <label for="marital_status">Marital Status</label>
              <select id="marital_status" name="marital_status">
                <option value="">-- Select --</option>
                <option>Single</option><option>Married</option><option>Divorced</option>
              </select>
            </div>
            <div class="col-4">
              <label for="aadhaar_pan">PAN / Aadhaar</label>
              <input id="aadhaar_pan" name="aadhaar_pan" type="text" placeholder="ABCDE1234F / 1234-5678-9012" />
            </div>
          </div>
        </div>

        <!-- Contact -->
        <div class="section">
          <h3><i class="fa fa-address-card"></i> Contact</h3>
          <div class="grid">
            <div class="col-6">
              <label for="email">Email</label>
              <input id="email" name="email" type="email" placeholder="example@mail.com" />
            </div>
            <div class="col-6">
              <label for="mobile">Mobile</label>
              <input id="mobile" name="mobile" type="tel" placeholder="10-digit number" />
            </div>
            <div class="col-12">
              <label for="address">Address</label>
              <textarea id="address" name="address" placeholder="House / Street, Area, City, PIN"></textarea>
            </div>
          </div>
        </div>

        <!-- Policy Details -->
        <div class="section">
          <h3><i class="fa fa-file-shield"></i> Policy Details</h3>
          <div class="grid">
            <div class="col-4">
              <label for="start_date">Start Date</label>
              <input id="start_date" name="start_date" type="date" />
            </div>
            <div class="col-4">
              <label for="end_date">End Date</label>
              <input id="end_date" name="end_date" type="date" />
            </div>
            <div class="col-4">
              <label for="mode_of_payment">Mode of Payment</label>
              <select id="mode_of_payment" name="mode_of_payment">
                <option value="">-- Select --</option>
                <option value="monthly">Monthly</option>
                <option value="quarterly">Quarterly</option>
                <option value="half-yearly">Half-Yearly</option>
                <option value="yearly">Yearly</option>
              </select>
            </div>
            <div class="col-4">
              <label for="next_premium_date">Next Premium Date</label>
              <input id="next_premium_date" name="next_premium_date" type="date" />
            </div>
            <div class="col-4">
              <label for="sum_assured">Sum Assured (₹)</label>
              <input id="sum_assured" name="sum_assured" type="number" step="0.01" />
            </div>
            <div class="col-4">
              <label for="policy_term">Policy Term (Years)</label>
              <input id="policy_term" name="policy_term" type="number" />
            </div>
            <div class="col-4">
              <label for="premium_term">Premium Term (Years)</label>
              <input id="premium_term" name="premium_term" type="number" />
            </div>
            <div class="col-4">
              <label for="premium">Premium (₹)</label>
              <input id="premium" name="premium" type="number" step="0.01" />
            </div>
            <div class="col-4">
              <label for="maturity_value">Maturity Value (₹)</label>
              <input id="maturity_value" name="maturity_value" type="number" step="0.01" />
            </div>
          </div>
        </div>

        <!-- Nominee -->
        <div class="section">
          <h3><i class="fa fa-people-roof"></i> Nominee</h3>
          <div class="grid">
            <div class="col-6">
              <label for="nominee_name">Name</label>
              <input id="nominee_name" name="nominee_name" type="text" />
            </div>
            <div class="col-6">
              <label for="nominee_relation">Relation</label>
              <input id="nominee_relation" name="nominee_relation" type="text" />
            </div>
          </div>
        </div>

        <!-- Health & Lifestyle -->
        <div class="section">
          <h3><i class="fa fa-heart-pulse"></i> Health & Lifestyle</h3>
          <div class="grid">
            <div class="col-4">
              <label for="height_cm">Height (cm)</label>
              <input id="height_cm" name="height_cm" type="number" step="0.1" />
            </div>
            <div class="col-4">
              <label for="weight_kg">Weight (kg)</label>
              <input id="weight_kg" name="weight_kg" type="number" step="0.1" />
            </div>
            <div class="col-12">
              <label for="health_lifestyle">Health / Lifestyle</label>
              <textarea id="health_lifestyle" name="health_lifestyle" placeholder="e.g., Non-smoker, regular exercise"></textarea>
            </div>
          </div>
        </div>

        <!-- Banking & Agent -->
        <div class="section">
          <h3><i class="fa fa-building-columns"></i> Banking & Agent</h3>
          <div class="grid">
            <div class="col-6"><label for="bank_account">Bank Account</label><input id="bank_account" name="bank_account" type="text" /></div>
            <div class="col-6"><label for="ifsc_code">IFSC</label><input id="ifsc_code" name="ifsc_code" type="text" /></div>
            <div class="col-6"><label for="bank_name">Bank Name</label><input id="bank_name" name="bank_name" type="text" /></div>
            <div class="col-6"><label for="agent_code">Agent Code</label><input id="agent_code" name="agent_code" type="text" /></div>
            <div class="col-6"><label for="branch_code">Branch Code</label><input id="branch_code" name="branch_code" type="text" /></div>
          </div>
        </div>

        <div class="form-footer">
          <button type="reset" class="btn" style="background:#f3f4f6;color:#111">Reset</button>
          <button type="submit" class="btn btn-primary"><i class="fa fa-check"></i> Save Policy</button>
        </div>
      </form>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // auto next premium date (given start + mode)
    const startEl = document.getElementById('start_date');
    const modeEl  = document.getElementById('mode_of_payment');
    const nextEl  = document.getElementById('next_premium_date');

    function calcNextDate() {
      const start = startEl.value ? new Date(startEl.value) : null;
      const mode  = modeEl.value;
      if (!start || !mode) return;
      const d = new Date(start);
      switch (mode) {
        case 'monthly': d.setMonth(d.getMonth() + 1); break;
        case 'quarterly': d.setMonth(d.getMonth() + 3); break;
        case 'half-yearly': d.setMonth(d.getMonth() + 6); break;
        case 'yearly': d.setFullYear(d.getFullYear() + 1); break;
      }
      nextEl.value = d.toISOString().split('T')[0];
    }
    startEl?.addEventListener('change', calcNextDate);
    modeEl?.addEventListener('change', calcNextDate);

    // toast helper
    const toastEl = document.getElementById('toast');
    function showToast(msg, isError=false){
      toastEl.textContent = msg;
      toastEl.className = 'toast' + (isError ? ' error' : '');
      toastEl.style.display = 'block';
      setTimeout(()=> toastEl.style.display = 'none', 2800);
    }

    // submit form
    const form = document.getElementById('policyForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const fullname = document.getElementById('fullname').value.trim();
      const dob = document.getElementById('dob').value;
      if (!fullname || !dob) { showToast('Please fill Name and DOB.', true); return; }

      const payload = Object.fromEntries(new FormData(form).entries());

      // convert numeric fields to numbers where appropriate (optional)
      ['sum_assured','premium_term','policy_term','premium','maturity_value','height_cm','weight_kg'].forEach(k=>{
        if (payload[k]) payload[k] = isNaN(Number(payload[k])) ? null : Number(payload[k]);
      });

      try {
        const res = await fetch('/policies/add', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (!res.ok || !data.success) throw new Error(data.error || data || 'Failed to save policy');
        showToast('✅ Policy saved (ID: ' + data.id + ')');
        form.reset();
      } catch (err) {
        console.error('Save failed:', err);
        showToast('❌ ' + err.message, true);
      }
    });

    document.getElementById('quickSaveBtn').addEventListener('click', ()=> form.requestSubmit());
  </script>
</body>
</html>
